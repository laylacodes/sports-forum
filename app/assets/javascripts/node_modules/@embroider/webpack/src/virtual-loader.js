"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@embroider/core");
let resolverLoader;
function setup(appRoot) {
    if ((resolverLoader === null || resolverLoader === void 0 ? void 0 : resolverLoader.appRoot) !== appRoot) {
        resolverLoader = new core_1.ResolverLoader(appRoot);
    }
    return resolverLoader;
}
function virtualLoader() {
    if (typeof this.query === 'string' && this.query[0] === '?') {
        let params = new URLSearchParams(this.query);
        let filename = params.get('f');
        let appRoot = params.get('a');
        if (!filename || !appRoot) {
            throw new Error(`bug in @embroider/webpack virtual loader, cannot locate params in ${this.query}`);
        }
        let { resolver } = setup(appRoot);
        this.resourcePath = filename;
        return (0, core_1.virtualContent)(filename, resolver);
    }
    throw new Error(`@embroider/webpack/src/virtual-loader received unexpected request: ${this.query}`);
}
exports.default = virtualLoader;
//# sourceMappingURL=virtual-loader.js.map