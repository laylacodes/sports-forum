{"version":3,"names":["BasePlugin","nanoid","Provider","RequestClient","Socket","emitSocketProgress","getSocketHost","EventManager","ProgressTimeout","RateLimitedQueue","internalRateLimitedQueue","NetworkError","isNetworkError","filterNonFailedFiles","filterFilesToEmitUploadStarted","packageJson","locale","buildResponseError","xhr","err","error","Error","Object","assign","data","request","setTypeInBlob","file","dataWithUpdatedType","slice","size","meta","type","_queueRequestSocketToken","_classPrivateFieldLooseKey","_upload","_requestSocketToken","_uploadRemote","_uploadBundle","_uploadFiles","_handleUpload","XHRUpload","constructor","uppy","opts","defineProperty","value","_uploadFiles2","_uploadBundle2","_uploadRemote2","_upload2","writable","options","getOptions","Client","remote","providerOptions","provider","client","allowedMetaFields","Array","isArray","keys","res","post","url","body","protocol","endpoint","fieldname","fieldName","metadata","fromEntries","map","name","httpMethod","method","useFormData","formData","headers","token","fileIDs","length","log","limit","files","getFilesByIds","filesFiltered","filesToEmit","emit","bundle","isSomeFileRemote","some","isRemote","TypeError","_classPrivateFieldLooseBase","id","title","defaultLocale","defaultOptions","responseUrlFieldName","timeout","withCredentials","responseType","getResponseData","responseText","parsedResponse","JSON","parse","getResponseError","_","response","validateStatus","status","i18nInit","requests","undefined","uploaderEvents","create","wrapPromiseFunction","priority","overrides","getState","xhrUpload","addMetadata","forEach","item","subItem","append","createFormDataUpload","formPost","FormData","createBundledUpload","connectToServerSocket","Promise","resolve","reject","serverToken","host","companionUrl","socket","createSocket","target","on","progressData","uploadURL","uploadResp","queuedRequest","done","close","remove","errData","resp","message","cause","run","isPaused","_socket","send","onFileRemove","_socket2","abort","onCancelAll","_temp","reason","_socket3","onRetryRequest","onRetry","onRetryAll","catch","fileID","cb","targetFileID","getFile","eventHandler","_this","arguments","install","capabilities","setState","individualCancellation","addUploader","uninstall","removeUploader","current","total","XMLHttpRequest","timer","i18n","seconds","Math","ceil","upload","addEventListener","ev","loaded","progress","lengthComputable","uploader","bytesUploaded","bytesTotal","open","toUpperCase","currentOpts","header","setRequestHeader","_ref","abortOn","signal","setFileState","_err$cause","optsFromState","emitError","_temp2","allSettled","i","parseInt","controller","AbortController","removedHandler","removedFile","uploadPromise","wrapSyncFunction","off","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport { nanoid } from 'nanoid/non-secure'\nimport { Provider, RequestClient, Socket } from '@uppy/companion-client'\nimport emitSocketProgress from '@uppy/utils/lib/emitSocketProgress'\nimport getSocketHost from '@uppy/utils/lib/getSocketHost'\nimport EventManager from '@uppy/utils/lib/EventManager'\nimport ProgressTimeout from '@uppy/utils/lib/ProgressTimeout'\nimport { RateLimitedQueue, internalRateLimitedQueue } from '@uppy/utils/lib/RateLimitedQueue'\nimport NetworkError from '@uppy/utils/lib/NetworkError'\nimport isNetworkError from '@uppy/utils/lib/isNetworkError'\nimport { filterNonFailedFiles, filterFilesToEmitUploadStarted } from '@uppy/utils/lib/fileFilters'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nfunction buildResponseError (xhr, err) {\n  let error = err\n  // No error message\n  if (!error) error = new Error('Upload error')\n  // Got an error message string\n  if (typeof error === 'string') error = new Error(error)\n  // Got something else\n  if (!(error instanceof Error)) {\n    error = Object.assign(new Error('Upload error'), { data: error })\n  }\n\n  if (isNetworkError(xhr)) {\n    error = new NetworkError(error, xhr)\n    return error\n  }\n\n  error.request = xhr\n  return error\n}\n\n/**\n * Set `data.type` in the blob to `file.meta.type`,\n * because we might have detected a more accurate file type in Uppy\n * https://stackoverflow.com/a/50875615\n *\n * @param {object} file File object with `data`, `size` and `meta` properties\n * @returns {object} blob updated with the new `type` set from `file.meta.type`\n */\nfunction setTypeInBlob (file) {\n  const dataWithUpdatedType = file.data.slice(0, file.data.size, file.meta.type)\n  return dataWithUpdatedType\n}\n\nexport default class XHRUpload extends BasePlugin {\n  // eslint-disable-next-line global-require\n  static VERSION = packageJson.version\n\n  #queueRequestSocketToken\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'uploader'\n    this.id = this.opts.id || 'XHRUpload'\n    this.title = 'XHRUpload'\n\n    this.defaultLocale = locale\n\n    // Default options\n    const defaultOptions = {\n      formData: true,\n      fieldName: opts.bundle ? 'files[]' : 'file',\n      method: 'post',\n      allowedMetaFields: null,\n      responseUrlFieldName: 'url',\n      bundle: false,\n      headers: {},\n      timeout: 30 * 1000,\n      limit: 5,\n      withCredentials: false,\n      responseType: '',\n      /**\n       * @param {string} responseText the response body string\n       */\n      getResponseData (responseText) {\n        let parsedResponse = {}\n        try {\n          parsedResponse = JSON.parse(responseText)\n        } catch (err) {\n          uppy.log(err)\n        }\n\n        return parsedResponse\n      },\n      /**\n       *\n       * @param {string} _ the response body string\n       * @param {XMLHttpRequest | respObj} response the response object (XHR or similar)\n       */\n      getResponseError (_, response) {\n        let error = new Error('Upload error')\n\n        if (isNetworkError(response)) {\n          error = new NetworkError(error, response)\n        }\n\n        return error\n      },\n      /**\n       * Check if the response from the upload endpoint indicates that the upload was successful.\n       *\n       * @param {number} status the response status code\n       */\n      validateStatus (status) {\n        return status >= 200 && status < 300\n      },\n    }\n\n    this.opts = { ...defaultOptions, ...opts }\n    this.i18nInit()\n\n    // Simultaneous upload limiting is shared across all uploads with this plugin.\n    if (internalRateLimitedQueue in this.opts) {\n      this.requests = this.opts[internalRateLimitedQueue]\n    } else {\n      this.requests = new RateLimitedQueue(this.opts.limit)\n    }\n\n    if (this.opts.bundle && !this.opts.formData) {\n      throw new Error('`opts.formData` must be true when `opts.bundle` is enabled.')\n    }\n\n    if (opts?.allowedMetaFields === undefined && 'metaFields' in this.opts) {\n      throw new Error('The `metaFields` option has been renamed to `allowedMetaFields`.')\n    }\n\n    this.uploaderEvents = Object.create(null)\n    this.#queueRequestSocketToken = this.requests.wrapPromiseFunction(this.#requestSocketToken, { priority: -1 })\n  }\n\n  getOptions (file) {\n    const overrides = this.uppy.getState().xhrUpload\n    const { headers } = this.opts\n\n    const opts = {\n      ...this.opts,\n      ...(overrides || {}),\n      ...(file.xhrUpload || {}),\n      headers: {},\n    }\n    // Support for `headers` as a function, only in the XHRUpload settings.\n    // Options set by other plugins in Uppy state or on the files themselves are still merged in afterward.\n    //\n    // ```js\n    // headers: (file) => ({ expires: file.meta.expires })\n    // ```\n    if (typeof headers === 'function') {\n      opts.headers = headers(file)\n    } else {\n      Object.assign(opts.headers, this.opts.headers)\n    }\n\n    if (overrides) {\n      Object.assign(opts.headers, overrides.headers)\n    }\n    if (file.xhrUpload) {\n      Object.assign(opts.headers, file.xhrUpload.headers)\n    }\n\n    return opts\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  addMetadata (formData, meta, opts) {\n    const allowedMetaFields = Array.isArray(opts.allowedMetaFields)\n      ? opts.allowedMetaFields\n      : Object.keys(meta) // Send along all fields by default.\n\n    allowedMetaFields.forEach((item) => {\n      if (Array.isArray(meta[item])) {\n        // In this case we don't transform `item` to add brackets, it's up to\n        // the user to add the brackets so it won't be overridden.\n        meta[item].forEach(subItem => formData.append(item, subItem))\n      } else {\n        formData.append(item, meta[item])\n      }\n    })\n  }\n\n  createFormDataUpload (file, opts) {\n    const formPost = new FormData()\n\n    this.addMetadata(formPost, file.meta, opts)\n\n    const dataWithUpdatedType = setTypeInBlob(file)\n\n    if (file.name) {\n      formPost.append(opts.fieldName, dataWithUpdatedType, file.meta.name)\n    } else {\n      formPost.append(opts.fieldName, dataWithUpdatedType)\n    }\n\n    return formPost\n  }\n\n  createBundledUpload (files, opts) {\n    const formPost = new FormData()\n\n    const { meta } = this.uppy.getState()\n    this.addMetadata(formPost, meta, opts)\n\n    files.forEach((file) => {\n      const options = this.getOptions(file)\n\n      const dataWithUpdatedType = setTypeInBlob(file)\n\n      if (file.name) {\n        formPost.append(options.fieldName, dataWithUpdatedType, file.name)\n      } else {\n        formPost.append(options.fieldName, dataWithUpdatedType)\n      }\n    })\n\n    return formPost\n  }\n\n  async #upload (file, current, total) {\n    const opts = this.getOptions(file)\n\n    this.uppy.log(`uploading ${current} of ${total}`)\n    return new Promise((resolve, reject) => {\n      const data = opts.formData\n        ? this.createFormDataUpload(file, opts)\n        : file.data\n\n      const xhr = new XMLHttpRequest()\n      this.uploaderEvents[file.id] = new EventManager(this.uppy)\n      let queuedRequest\n\n      const timer = new ProgressTimeout(opts.timeout, () => {\n        const error = new Error(this.i18n('uploadStalled', { seconds: Math.ceil(opts.timeout / 1000) }))\n        this.uppy.emit('upload-stalled', error, [file])\n      })\n\n      const id = nanoid()\n\n      xhr.upload.addEventListener('loadstart', () => {\n        this.uppy.log(`[XHRUpload] ${id} started`)\n      })\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        this.uppy.log(`[XHRUpload] ${id} progress: ${ev.loaded} / ${ev.total}`)\n        // Begin checking for timeouts when progress starts, instead of loading,\n        // to avoid timing out requests on browser concurrency queue\n        timer.progress()\n\n        if (ev.lengthComputable) {\n          this.uppy.emit('upload-progress', file, {\n            uploader: this,\n            bytesUploaded: ev.loaded,\n            bytesTotal: ev.total,\n          })\n        }\n      })\n\n      xhr.addEventListener('load', () => {\n        this.uppy.log(`[XHRUpload] ${id} finished`)\n        timer.done()\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id].remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        if (opts.validateStatus(xhr.status, xhr.responseText, xhr)) {\n          const body = opts.getResponseData(xhr.responseText, xhr)\n          const uploadURL = body[opts.responseUrlFieldName]\n\n          const uploadResp = {\n            status: xhr.status,\n            body,\n            uploadURL,\n          }\n\n          this.uppy.emit('upload-success', file, uploadResp)\n\n          if (uploadURL) {\n            this.uppy.log(`Download ${file.name} from ${uploadURL}`)\n          }\n\n          return resolve(file)\n        }\n        const body = opts.getResponseData(xhr.responseText, xhr)\n        const error = buildResponseError(xhr, opts.getResponseError(xhr.responseText, xhr))\n\n        const response = {\n          status: xhr.status,\n          body,\n        }\n\n        this.uppy.emit('upload-error', file, error, response)\n        return reject(error)\n      })\n\n      xhr.addEventListener('error', () => {\n        this.uppy.log(`[XHRUpload] ${id} errored`)\n        timer.done()\n        queuedRequest.done()\n        if (this.uploaderEvents[file.id]) {\n          this.uploaderEvents[file.id].remove()\n          this.uploaderEvents[file.id] = null\n        }\n\n        const error = buildResponseError(xhr, opts.getResponseError(xhr.responseText, xhr))\n        this.uppy.emit('upload-error', file, error)\n        return reject(error)\n      })\n\n      xhr.open(opts.method.toUpperCase(), opts.endpoint, true)\n      // IE10 does not allow setting `withCredentials` and `responseType`\n      // before `open()` is called.\n      xhr.withCredentials = opts.withCredentials\n      if (opts.responseType !== '') {\n        xhr.responseType = opts.responseType\n      }\n\n      queuedRequest = this.requests.run(() => {\n        // When using an authentication system like JWT, the bearer token goes as a header. This\n        // header needs to be fresh each time the token is refreshed so computing and setting the\n        // headers just before the upload starts enables this kind of authentication to work properly.\n        // Otherwise, half-way through the list of uploads the token could be stale and the upload would fail.\n        const currentOpts = this.getOptions(file)\n\n        Object.keys(currentOpts.headers).forEach((header) => {\n          xhr.setRequestHeader(header, currentOpts.headers[header])\n        })\n\n        xhr.send(data)\n\n        return () => {\n          timer.done()\n          xhr.abort()\n        }\n      })\n\n      this.onFileRemove(file.id, () => {\n        queuedRequest.abort()\n        reject(new Error('File removed'))\n      })\n\n      this.onCancelAll(file.id, ({ reason }) => {\n        if (reason === 'user') {\n          queuedRequest.abort()\n        }\n        reject(new Error('Upload cancelled'))\n      })\n    })\n  }\n\n  #requestSocketToken = async (file, options) => {\n    const opts = this.getOptions(file)\n    const Client = file.remote.providerOptions.provider ? Provider : RequestClient\n    const client = new Client(this.uppy, file.remote.providerOptions)\n    const allowedMetaFields = Array.isArray(opts.allowedMetaFields)\n      ? opts.allowedMetaFields\n      // Send along all fields by default.\n      : Object.keys(file.meta)\n    const res = await client.post(file.remote.url, {\n      ...file.remote.body,\n      protocol: 'multipart',\n      endpoint: opts.endpoint,\n      size: file.data.size,\n      fieldname: opts.fieldName,\n      metadata: Object.fromEntries(allowedMetaFields.map(name => [name, file.meta[name]])),\n      httpMethod: opts.method,\n      useFormData: opts.formData,\n      headers: opts.headers,\n    }, options)\n    return res.token\n  }\n\n  // NOTE! Keep this duplicated code in sync with other plugins\n  // TODO we should probably abstract this into a common function\n  async #uploadRemote (file, options) {\n    // TODO: we could rewrite this to use server-sent events instead of creating WebSockets.\n    try {\n      if (file.serverToken) {\n        return await this.connectToServerSocket(file)\n      }\n      const serverToken = await this.#queueRequestSocketToken(file, options).abortOn(options?.signal)\n\n      if (!this.uppy.getState().files[file.id]) return undefined\n\n      this.uppy.setFileState(file.id, { serverToken })\n      return await this.connectToServerSocket(this.uppy.getFile(file.id))\n    } catch (err) {\n      if (err?.cause?.name !== 'AbortError') {\n        this.uppy.setFileState(file.id, { serverToken: undefined })\n        this.uppy.emit('upload-error', file, err)\n        throw err\n      }\n      // The file upload was aborted, it’s not an error\n      return undefined\n    }\n  }\n\n  async connectToServerSocket (file) {\n    return new Promise((resolve, reject) => {\n      const opts = this.getOptions(file)\n      const token = file.serverToken\n      const host = getSocketHost(file.remote.companionUrl)\n      let socket\n\n      const createSocket = () => {\n        if (socket != null) return\n\n        socket = new Socket({ target: `${host}/api/${token}` })\n\n        socket.on('progress', (progressData) => emitSocketProgress(this, progressData, file))\n\n        socket.on('success', (data) => {\n          const body = opts.getResponseData(data.response.responseText, data.response)\n          const uploadURL = body[opts.responseUrlFieldName]\n\n          const uploadResp = {\n            status: data.response.status,\n            body,\n            uploadURL,\n          }\n\n          this.uppy.emit('upload-success', file, uploadResp)\n          queuedRequest.done() // eslint-disable-line no-use-before-define\n          socket.close()\n          if (this.uploaderEvents[file.id]) {\n            this.uploaderEvents[file.id].remove()\n            this.uploaderEvents[file.id] = null\n          }\n          return resolve()\n        })\n\n        socket.on('error', (errData) => {\n          const resp = errData.response\n          const error = resp\n            ? opts.getResponseError(resp.responseText, resp)\n            : Object.assign(new Error(errData.error.message), { cause: errData.error })\n          this.uppy.emit('upload-error', file, error)\n          queuedRequest.done() // eslint-disable-line no-use-before-define\n          socket.close()\n          if (this.uploaderEvents[file.id]) {\n            this.uploaderEvents[file.id].remove()\n            this.uploaderEvents[file.id] = null\n          }\n          reject(error)\n        })\n      }\n      this.uploaderEvents[file.id] = new EventManager(this.uppy)\n\n      let queuedRequest = this.requests.run(() => {\n        if (file.isPaused) {\n          socket?.send('pause', {})\n        } else {\n          createSocket()\n        }\n\n        return () => {}\n      })\n\n      this.onFileRemove(file.id, () => {\n        socket?.send('cancel', {})\n        socket.close()\n        queuedRequest.abort()\n        resolve(`upload ${file.id} was removed`)\n      })\n\n      this.onCancelAll(file.id, ({ reason } = {}) => {\n        if (reason === 'user') {\n          socket?.send('cancel', {})\n          queuedRequest.abort()\n          // socket.close()\n        }\n        resolve(`upload ${file.id} was canceled`)\n      })\n\n      const onRetryRequest = () => {\n        if (socket == null) {\n          queuedRequest.abort()\n        } else {\n          queuedRequest.done()\n        }\n        queuedRequest = this.requests.run(() => {\n          if (socket == null) {\n            createSocket()\n          }\n          return () => {}\n        })\n      }\n      this.onRetry(file.id, onRetryRequest)\n      this.onRetryAll(file.id, onRetryRequest)\n    }).catch((err) => {\n      this.uppy.emit('upload-error', file, err)\n      return Promise.reject(err)\n    })\n  }\n\n  #uploadBundle (files) {\n    return new Promise((resolve, reject) => {\n      const { endpoint } = this.opts\n      const { method } = this.opts\n\n      const optsFromState = this.uppy.getState().xhrUpload\n      const formData = this.createBundledUpload(files, {\n        ...this.opts,\n        ...(optsFromState || {}),\n      })\n\n      const xhr = new XMLHttpRequest()\n\n      const emitError = (error) => {\n        files.forEach((file) => {\n          this.uppy.emit('upload-error', file, error)\n        })\n      }\n\n      const timer = new ProgressTimeout(this.opts.timeout, () => {\n        const error = new Error(this.i18n('uploadStalled', { seconds: Math.ceil(this.opts.timeout / 1000) }))\n        this.uppy.emit('upload-stalled', error, files)\n      })\n\n      xhr.upload.addEventListener('loadstart', () => {\n        this.uppy.log('[XHRUpload] started uploading bundle')\n        timer.progress()\n      })\n\n      xhr.upload.addEventListener('progress', (ev) => {\n        timer.progress()\n\n        if (!ev.lengthComputable) return\n\n        files.forEach((file) => {\n          this.uppy.emit('upload-progress', file, {\n            uploader: this,\n            bytesUploaded: (ev.loaded / ev.total) * file.size,\n            bytesTotal: file.size,\n          })\n        })\n      })\n\n      xhr.addEventListener('load', (ev) => {\n        timer.done()\n\n        if (this.opts.validateStatus(ev.target.status, xhr.responseText, xhr)) {\n          const body = this.opts.getResponseData(xhr.responseText, xhr)\n          const uploadResp = {\n            status: ev.target.status,\n            body,\n          }\n          files.forEach((file) => {\n            this.uppy.emit('upload-success', file, uploadResp)\n          })\n          return resolve()\n        }\n\n        const error = this.opts.getResponseError(xhr.responseText, xhr) || new Error('Upload error')\n        error.request = xhr\n        emitError(error)\n        return reject(error)\n      })\n\n      xhr.addEventListener('error', () => {\n        timer.done()\n\n        const error = this.opts.getResponseError(xhr.responseText, xhr) || new Error('Upload error')\n        emitError(error)\n        return reject(error)\n      })\n\n      this.uppy.on('cancel-all', ({ reason } = {}) => {\n        if (reason !== 'user') return\n        timer.done()\n        xhr.abort()\n      })\n\n      xhr.open(method.toUpperCase(), endpoint, true)\n      // IE10 does not allow setting `withCredentials` and `responseType`\n      // before `open()` is called.\n      xhr.withCredentials = this.opts.withCredentials\n      if (this.opts.responseType !== '') {\n        xhr.responseType = this.opts.responseType\n      }\n\n      Object.keys(this.opts.headers).forEach((header) => {\n        xhr.setRequestHeader(header, this.opts.headers[header])\n      })\n\n      xhr.send(formData)\n    })\n  }\n\n  async #uploadFiles (files) {\n    await Promise.allSettled(files.map((file, i) => {\n      const current = parseInt(i, 10) + 1\n      const total = files.length\n\n      if (file.isRemote) {\n        const controller = new AbortController()\n\n        const removedHandler = (removedFile) => {\n          if (removedFile.id === file.id) controller.abort()\n        }\n        this.uppy.on('file-removed', removedHandler)\n\n        const uploadPromise = this.#uploadRemote(file, { signal: controller.signal })\n\n        this.requests.wrapSyncFunction(() => {\n          this.uppy.off('file-removed', removedHandler)\n        }, { priority: -1 })()\n\n        return uploadPromise\n      }\n      return this.#upload(file, current, total)\n    }))\n  }\n\n  onFileRemove (fileID, cb) {\n    this.uploaderEvents[fileID].on('file-removed', (file) => {\n      if (fileID === file.id) cb(file.id)\n    })\n  }\n\n  onRetry (fileID, cb) {\n    this.uploaderEvents[fileID].on('upload-retry', (targetFileID) => {\n      if (fileID === targetFileID) {\n        cb()\n      }\n    })\n  }\n\n  onRetryAll (fileID, cb) {\n    this.uploaderEvents[fileID].on('retry-all', () => {\n      if (!this.uppy.getFile(fileID)) return\n      cb()\n    })\n  }\n\n  onCancelAll (fileID, eventHandler) {\n    this.uploaderEvents[fileID].on('cancel-all', (...args) => {\n      if (!this.uppy.getFile(fileID)) return\n      eventHandler(...args)\n    })\n  }\n\n  #handleUpload = async (fileIDs) => {\n    if (fileIDs.length === 0) {\n      this.uppy.log('[XHRUpload] No files to upload!')\n      return\n    }\n\n    // No limit configured by the user, and no RateLimitedQueue passed in by a \"parent\" plugin\n    // (basically just AwsS3) using the internal symbol\n    if (this.opts.limit === 0 && !this.opts[internalRateLimitedQueue]) {\n      this.uppy.log(\n        '[XHRUpload] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/xhr-upload/#limit-0',\n        'warning',\n      )\n    }\n\n    this.uppy.log('[XHRUpload] Uploading...')\n    const files = this.uppy.getFilesByIds(fileIDs)\n\n    const filesFiltered = filterNonFailedFiles(files)\n    const filesToEmit = filterFilesToEmitUploadStarted(filesFiltered)\n    this.uppy.emit('upload-start', filesToEmit)\n\n    if (this.opts.bundle) {\n      // if bundle: true, we don’t support remote uploads\n      const isSomeFileRemote = filesFiltered.some(file => file.isRemote)\n      if (isSomeFileRemote) {\n        throw new Error('Can’t upload remote files when the `bundle: true` option is set')\n      }\n\n      if (typeof this.opts.headers === 'function') {\n        throw new TypeError('`headers` may not be a function when the `bundle: true` option is set')\n      }\n\n      await this.#uploadBundle(filesFiltered)\n    } else {\n      await this.#uploadFiles(filesFiltered)\n    }\n  }\n\n  install () {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: false,\n        },\n      })\n    }\n\n    this.uppy.addUploader(this.#handleUpload)\n  }\n\n  uninstall () {\n    if (this.opts.bundle) {\n      const { capabilities } = this.uppy.getState()\n      this.uppy.setState({\n        capabilities: {\n          ...capabilities,\n          individualCancellation: true,\n        },\n      })\n    }\n\n    this.uppy.removeUploader(this.#handleUpload)\n  }\n}\n"],"mappings":"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"}