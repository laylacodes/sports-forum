{"version":3,"names":["BasePlugin","getDroppedFiles","toArray","packageJson","isFileTransfer","event","dataTransfer","types","some","type","DropTarget","constructor","uppy","opts","addFiles","files","descriptors","map","file","source","id","name","data","meta","relativePath","err","log","handleDrop","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","currentTarget","classList","remove","setPluginState","isDraggingOver","iteratePlugins","plugin","handleRootDrop","executedDropErrorOnce","logDropError","error","info","message","length","onDrop","handleDragOver","dropEffect","add","onDragOver","handleDragLeave","setTimeout","onDragLeave","addListeners","target","Element","nodes","document","querySelectorAll","Error","forEach","node","addEventListener","removeListeners","removeEventListener","title","defaultOpts","install","uninstall","VERSION","version"],"sources":["index.js"],"sourcesContent":["import BasePlugin from '@uppy/core/lib/BasePlugin.js'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport toArray from '@uppy/utils/lib/toArray'\n\nimport packageJson from '../package.json'\n\nfunction isFileTransfer (event) {\n  return event.dataTransfer.types?.some((type) => type === 'Files') ?? false\n}\n\n/**\n * Drop Target plugin\n *\n */\nexport default class DropTarget extends BasePlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DropTarget'\n    this.title = 'Drop Target'\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n    this.removeDragOverClassTimeout = null\n  }\n\n  addFiles = (files) => {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  handleDrop = async (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    event.currentTarget.classList.remove('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: false })\n\n    // Let any acquirer plugin (Url/Webcam/etc.) handle drops to the root\n    this.uppy.iteratePlugins((plugin) => {\n      if (plugin.type === 'acquirer') {\n        // Every Plugin with .type acquirer can define handleRootDrop(event)\n        plugin.handleRootDrop?.(event)\n      }\n    })\n\n    // Add all dropped files, handle errors\n    let executedDropErrorOnce = false\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n\n      // In practice all drop errors are most likely the same,\n      // so let's just show one to avoid overwhelming the user\n      if (!executedDropErrorOnce) {\n        this.uppy.info(error.message, 'error')\n        executedDropErrorOnce = true\n      }\n    }\n\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DropTarget] Files were dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  handleDragOver = (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser,\n    // https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy' // eslint-disable-line no-param-reassign\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    event.currentTarget.classList.add('uppy-is-drag-over')\n    this.setPluginState({ isDraggingOver: true })\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave = (event) => {\n    if (!isFileTransfer(event)) {\n      return\n    }\n\n    event.preventDefault()\n    event.stopPropagation()\n\n    const { currentTarget } = event\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      currentTarget.classList.remove('uppy-is-drag-over')\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n    this.opts.onDragLeave?.(event)\n  }\n\n  addListeners = () => {\n    const { target } = this.opts\n\n    if (target instanceof Element) {\n      this.nodes = [target]\n    } else if (typeof target === 'string') {\n      this.nodes = toArray(document.querySelectorAll(target))\n    }\n\n    if (!this.nodes && !this.nodes.length > 0) {\n      throw new Error(`\"${target}\" does not match any HTML elements`)\n    }\n\n    this.nodes.forEach((node) => {\n      node.addEventListener('dragover', this.handleDragOver, false)\n      node.addEventListener('dragleave', this.handleDragLeave, false)\n      node.addEventListener('drop', this.handleDrop, false)\n    })\n  }\n\n  removeListeners = () => {\n    if (this.nodes) {\n      this.nodes.forEach((node) => {\n        node.removeEventListener('dragover', this.handleDragOver, false)\n        node.removeEventListener('dragleave', this.handleDragLeave, false)\n        node.removeEventListener('drop', this.handleDrop, false)\n      })\n    }\n  }\n\n  install () {\n    this.setPluginState({ isDraggingOver: false })\n    this.addListeners()\n  }\n\n  uninstall () {\n    this.removeListeners()\n  }\n}\n"],"mappings":"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"}