{"version":3,"sources":["scripts/splash-screen.js"],"sourcesContent":["// This script is inlined in `_discourse_splash.html.erb\nconst DELAY_TARGET = 2000;\nconst POLLING_INTERVAL = 50;\nconst splashSvgTemplate = document.querySelector(\".splash-svg-template\");\nconst splashTemplateClone = splashSvgTemplate.content.cloneNode(true);\nconst svgElement = splashTemplateClone.querySelector(\"svg\");\nconst svgString = new XMLSerializer().serializeToString(svgElement);\nconst encodedSvg = btoa(svgString);\nconst splashWrapper = document.querySelector(\"#d-splash\");\nconst splashImage = splashWrapper && splashWrapper.querySelector(\".preloader-image\");\nif (splashImage) {\n  splashImage.src = `data:image/svg+xml;base64,${encodedSvg}`;\n  const connectStart = performance.timing.connectStart || 0;\n  const targetTime = connectStart + DELAY_TARGET;\n  let splashInterval;\n  let discourseReady;\n  const swapSplash = () => {\n    splashWrapper && splashWrapper.style.setProperty(\"--animation-state\", \"running\");\n    svgElement && svgElement.style.setProperty(\"--animation-state\", \"running\");\n    const newSvgString = new XMLSerializer().serializeToString(svgElement);\n    const newEncodedSvg = btoa(newSvgString);\n    splashImage.src = `data:image/svg+xml;base64,${newEncodedSvg}`;\n    performance.mark(\"discourse-splash-visible\");\n    clearSplashInterval();\n  };\n  const clearSplashInterval = () => {\n    clearInterval(splashInterval);\n    splashInterval = null;\n  };\n  (() => {\n    splashInterval = setInterval(() => {\n      if (discourseReady) {\n        clearSplashInterval();\n      }\n      if (Date.now() > targetTime) {\n        swapSplash();\n      }\n    }, POLLING_INTERVAL);\n  })();\n  document.addEventListener(\"discourse-ready\", () => {\n    discourseReady = true;\n    splashWrapper && splashWrapper.remove();\n    performance.mark(\"discourse-splash-removed\");\n  }, {\n    once: true\n  });\n}\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;","file":"splash-screen.js"}