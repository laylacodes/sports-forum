{"version":3,"sources":["discourse/plugins/discourse-narrative-bot/initializers/new-user-narrative.js"],"sourcesContent":["define(\"discourse/plugins/discourse-narrative-bot/initializers/new-user-narrative\", [\"exports\", \"discourse/lib/plugin-api\", \"discourse-common/utils/decorators\"], function (_exports, _pluginApi, _decorators) {\n  \"use strict\";\n\n  Object.defineProperty(_exports, \"__esModule\", {\n    value: true\n  });\n  _exports.default = void 0;\n  var _obj;\n  function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\n  var _default = _exports.default = (_obj = {\n    name: \"new-user-narrative\",\n    initialize(container) {\n      const siteSettings = container.lookup(\"service:site-settings\");\n      if (!siteSettings.discourse_narrative_bot_enabled) {\n        return;\n      }\n      this.messageBus = container.lookup(\"service:message-bus\");\n      this.appEvents = container.lookup(\"service:app-events\");\n      (0, _pluginApi.withPluginApi)(\"0.8.7\", api => {\n        this.currentUser = api.getCurrentUser();\n        if (!this.currentUser) {\n          return;\n        }\n        api.dispatchWidgetAppEvent(\"site-header\", \"header\", \"header:search-context-trigger\");\n        api.attachWidgetAction(\"header\", \"headerSearchContextTrigger\", function () {\n          if (this.site.mobileView) {\n            this.state.skipSearchContext = false;\n          } else {\n            this.state.contextEnabled = true;\n            this.state.searchContextType = \"topic\";\n          }\n        });\n        this.messageBus.subscribe(`/new_user_narrative/tutorial_search/${this.currentUser.id}`, this.onMessage);\n      });\n    },\n    teardown() {\n      if (this.currentUser) {\n        this.messageBus?.unsubscribe(`/new_user_narrative/tutorial_search/${this.currentUser.id}`, this.onMessage);\n      }\n    },\n    onMessage() {\n      this.appEvents.trigger(\"header:search-context-trigger\");\n    }\n  }, (_applyDecoratedDescriptor(_obj, \"onMessage\", [_decorators.bind], Object.getOwnPropertyDescriptor(_obj, \"onMessage\"), _obj)), _obj);\n});"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;","file":"discourse-narrative-bot.js"}